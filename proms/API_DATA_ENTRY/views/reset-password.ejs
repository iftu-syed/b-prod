<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password</title>
    <link rel="stylesheet" href="<%= basePath %>/dataentrylogin.css">
    <link href="https://fonts.googleapis.com/css2?family=Urbanist:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <style>
        .flash-message.error {
            color: #a94442;
            margin-bottom: 5px;
        }

        .flash-message.success {
            color: #3c763d;
            margin-bottom: 5px;
        }

        .flash-message {
            animation: fadeOut 3s forwards;
        }

        @keyframes fadeOut {
            0% { opacity: 1; }
            90% { opacity: 1; }
            100% { opacity: 0; display: none; }
        }
    </style>
</head>
<body>

    <div><h1><span style="font-weight: normal;">Reset Your Password</span></h1></div>
    <div class="login-container">
        <form action="<%= basePath %>/reset-password" method="POST" class="login-form" onsubmit="return validatePassword()">
            <hr class="spacer">            
            <img src="<%= basePath %>/assets/images/logo.png">
            <hr class="spacer">
            
            <input type="password" id="newPassword" name="newPassword" placeholder="New Password" required>
            <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Confirm Password" required>
        
            <div id="password-error" class="flash-message error" style="display: none;"></div>
        
            <% if (typeof success_msg !== 'undefined' && success_msg) { %>
                <div class="flash-message success"><%= success_msg %></div>
            <% } %>
            <% if (typeof error_msg !== 'undefined' && error_msg) { %>
                <div class="flash-message error"><%= error_msg %></div>
            <% } %>
        
            <button type="submit" class="lgbtn">Update Password</button>
            <hr class="spacer">
        </form>
        
    </div>
    <hr class="spacer">
    <div style="display: flex; justify-content: space-around;">
        <h1>Let's power up with PROMs</h1>
    </div>
    <hr class="spacer">
    <div style="display: flex; justify-content: space-around; color: grey;">
        © WeHealthify · Contact  ·  Privacy Policy
    </div>

    <script>
        function validatePassword() {
            const password = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const errorMessage = document.getElementById('password-error');
            
            // Regex for password validation (at least 1 uppercase letter, 1 number, 1 special character, and 6 characters)
            const passwordRegex = /^(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*])[A-Za-z\d!@#$%^&*]{6,}$/;
    
            // Validate if the password meets the regex
            if (!password.match(passwordRegex)) {
                let missingRequirement = '';
    
                // Check and provide specific feedback
                if (password.length < 6) {
                    missingRequirement = "Password must be at least 6 characters long.";
                } else if (!/[A-Z]/.test(password)) {
                    missingRequirement = "Password must contain at least one uppercase letter.";
                } else if (!/\d/.test(password)) {
                    missingRequirement = "Password must contain at least one number.";
                } else if (!/[!@#$%^&*]/.test(password)) {
                    missingRequirement = "Password must contain at least one special character.";
                }
    
                errorMessage.textContent = missingRequirement;
                errorMessage.style.display = 'block';
    
                // Set timeout to hide the message after 3 seconds
                setTimeout(() => {
                    errorMessage.style.display = 'none';
                }, 3000);
    
                return false; // Prevent form submission
            }
    
            // Check if passwords match
            if (password !== confirmPassword) {
                errorMessage.textContent = "Passwords do not match.";
                errorMessage.style.display = 'block';
    
                setTimeout(() => {
                    errorMessage.style.display = 'none';
                }, 3000);
    
                return false; // Prevent form submission
            }
    
            return true; // Allow form submission if everything is valid
        }
    </script>
    
    
</body>
</html>