<!-- views/data-entry.ejs -->

<!-- The EJS template includes HTML markup with EJS syntax for dynamic content -->

<!-- views/data-entry.ejs -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Entry Form</title>
    <link rel="stylesheet" href="/styles.css"> <!-- Correct the path to your CSS file -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

    <style>
        .optional-text {
            font-size: smaller; /* Adjust the size as needed */
            color: gray;       /* Optional: Change color for more distinction */
        }

        .csv-upload-button {
        position: absolute;
        left: 20px;
        top: 50%;
        transform: translateY(-50%);
        background-color: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        cursor: pointer;
        font-size: 16px;
        border-radius: 4px;
    }

    .csv-upload-button:hover {
        background-color: #0056b3;
    }

    #csvFile {
        display: none;
    }
    </style>
</head>
<body>



    
    <div class="csv-upload-container">


    <script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>
    <div class="main-container">
        <div class="topContainer">
            <img src="/assets/images/logo.png">
            <h2 style="text-align: center; margin-bottom: 20px;">Data Entry Form</h2>
        </div>
        
        <!-- image -->
        <div class="container">
            
            <div class="left-section">
                <h4>Batch Appointments</h4>

                
                <!-- <div class="upload-area"> -->
                    
                    <form id="csvUploadForm" class="upload-area" method="POST" action="/api/upload-csv" enctype="multipart/form-data" style="position: relative;">
                        <box-icon name='upload'></box-icon>
                        <p><b> Select a CSV file to upload </b><br> or drag and drop it here</p>
                        <input type="file" id="csvFile" name="csvFile" accept=".csv" required>
                        <!-- <button type="button" class="csv-upload-button" onclick="document.getElementById('csvFile').click()">Upload CSV</button> -->
                    </form>


                   
                <a href="Data_Entry_Incoming.patient_data.csv"><box-icon name='download'></box-icon> <span style="padding-left: 10px;"><b>Find CSV Template Here</b></span></a>
                <!-- <button class="upload-btn">Upload</button> -->
                 <div style="text-align: center;">
                    <button type="button" class="upload-btn" onclick="document.getElementById('csvFile').click()"><i class='bx bx-upload' ></i> Upload CSV</button>
                 </div>
            </div>


    <div class="middle-section">

        <h4>Single Appointments</h4>
        
        <form id="dataForm" method="POST" action="/api/data">
            <div class="form-group">
                <label for="Mr_no" class="form-label">MR Number</label>
                <input type="text" id="Mr_no" class="form-input"name="Mr_no" required>
                
            </div>
            <div class="form-group">

                <label for="Name" class="form-label">Name:</label>
                <input type="text" class="form-input" id="Name" name="Name" required>
                
            </div>

            <div class="form-group">

                <label for="DOB" class="form-label">Date of Birth:</label>
                <input type="date" class="form-input" id="DOB" name="DOB" required>

            </div>



                <!-- <select id="speciality" name="speciality" required> -->
                <!-- <label for="speciality" class="form-label"  name="speciality" required>Speciality</label>
                <select id="speciality" class="form-select">
                    <option value="">Select Speciality</option>
                    <option value="cardiology">Cardiology</option>
                    <option value="neurology">Neurology</option>
                    <option value="oncology">Oncology</option>
                    <option value="orthopedics">Orthopedics</option>
                    <option value="pediatrics">Pediatrics</option>
                </select> -->
         

            <!-- <div class="form-group">
                <label for="dateOfSurgery" class="form-label">Date of Surgery</label><span class="optional-text">(Optional)</span>:
                <input type="datetime-local" id="appointment" name="dateOfSurgery" class="form-input">
            </div> -->

        <!-- </form> -->
        
    </div>




    <div class="right-section">
        <h1></h1>
        
            
            <div class="form-group">
                <label for="phoneNumber" class="form-label">Phone Number</label>
                <input type="tel" id="phoneNumber" class="form-input" name="phoneNumber" required>
                
            </div>

            <div class="form-group">
                <label for="datetime" class="form-label">Appointment Date & Time</label>
                <input type="datetime-local" id="datetime" class="form-input" name="datetime" required>
            </div>


            <div class="form-group">
                <label for="speciality" class="form-label"  name="speciality" required>Speciality </label>
                <select id="speciality" class="form-select">
                    <option value="">Select Speciality <span class="arrow"></span></option>
                    <% if (specialities && specialities.length > 0) { %>
                        <% specialities.forEach(function(speciality) { %>
                            <option value="<%= speciality %>"><%= speciality %></option>
                        <% }); %>
                    <% } else { %>
                        <option value="" disabled>No specialities available</option>
                    <% } %>
                </select>
            </div>


            <input type="hidden" name="hospital" value="<%= hospital %>">
            <input type="hidden" name="surveyStatus" value="Not Completed"> 
            
            <button type="submit" class="submit-btn"><i class='bx bx-check-double'></i> Submit</button>
        </form>

    </div>    

        </div>
    </div>
    </div>




    <!-- Confirmation message -->
    <div id="confirmationMessage" style="display: none;">Data Entry is done.</div>

    <% if (typeof successMessage !== 'undefined' && successMessage !== '') { %>
        <div class="success-message">
            <%= successMessage %>
        </div>
        <script>
            setTimeout(() => {
                window.location.href = '/'; // Redirect after 3 seconds
            }, 3000);
        </script>
    <% } %>

    <!-- Include Flatpickr library -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/en.js"></script>
    <script>
        // Restricting the Date of Birth to not allow future dates
        const dobInput = document.getElementById('DOB');
        const today = new Date().toISOString().split('T')[0]; // Get today's date in YYYY-MM-DD format
        dobInput.setAttribute('max', today); // Set the max attribute to today

        // Initialize Flatpickr with custom minute increments and 12-hour time format
        flatpickr("#datetime", {
            enableTime: true,
            dateFormat: "Y-m-d h:i K", // Store the value in 12-hour format with AM/PM
            time_24hr: false, // Use 12-hour format with AM/PM
            minuteIncrement: 15, // Set minute increments to 15 (00, 15, 30, 45)
            minDate: "today", // Disable past dates and times
            altInput: true, // Use an alternative input for displaying the formatted date
            altFormat: "F j, Y h:i K", // Display format for the alternative input (12-hour time with AM/PM)
            defaultHour: 12, // Set default hour to 12 PM
        });
        

        // Automatically fetch patient data when MR Number changes
        document.getElementById('Mr_no').addEventListener('change', function() {
            var mrNo = this.value;
            if (mrNo) {
                // Fetch patient data
                fetch(`/api/patient/${mrNo}`)
                    .then(response => response.json())
                    .then(patientData => {
                        if (patientData.success) {
                            const patient = patientData.patient;
    
                            // Populate the form fields with the returned data
                            document.getElementById('Name').value = patient.Name || '';
                            document.getElementById('DOB').value = patient.DOB || '';
                            // document.getElementById('datetime').value = patient.datetime || '';
                            // document.getElementById('dateOfSurgery').value = patient.dateOfSurgery || '';
                            document.getElementById('phoneNumber').value = patient.phoneNumber || '';
                        } else {
                            alert('Patient not found.');
                        }
                    })
                    .catch(error => console.error('Error fetching patient data:', error));
            }
        });
    </script>
</body>
</html>
