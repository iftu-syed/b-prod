<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stool incontinence Survey (Wexner)</title>
  <link rel="stylesheet" href="<%= basePath %>/styles/survey.css">
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Urbanist:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

</head>

<body>

  <button class="lang-toggle" onclick="toggleLanguage()">العربية</button>
  
<div class="parentrow">
    
  <div class="parentcolumn left">

    <div class="sidebar">
      <hr class="spacer">
      <img src="<%= basePath %>/assets/images/logo.png">
      <hr class="spacer">
      <% surveyStatus.forEach((survey, index) => { %>
        <div class="<%= survey.active ? 'sidebar-item-active' : (survey.completed ? 'sidebar-item-done' : 'sidebar-item-inactive') %>">
          <%= survey.name %>
        </div>
      <% }) %>
    </div>
      
  </div>

  <diipv class="parentcolumn right">
    <div class="infobox">

      <div class="mobile-container">

        <img src="<%= basePath %>/assets/images/logo.png">

        
      </div>
      <!-- Progress Bar -->
      <h1 data-en="Stool incontinence Survey (Wexner)" data-ar="استطلاع سلس البراز (ويكسنر)">
        Stool incontinence Survey (Wexner)
    </h1>
    <p id="text" class="info-text">
    This Wexner PROMS is designed to help us understand your bowel habits and your symptoms and overall quality of life. By completing this survey, you provide valuable information that enables us to offer you the best possible care and support tailored to your needs.
      <span id="dots" style="display:none;">...</span>
      <span id="more-text" style="display:none;"></span>
      <span id="toggle-btn" onclick="toggleText()" style="color: blue; cursor: pointer; display:none;"> Show More</span>
    </p>
    
    
<hr class="spacer">
      <div class="progress-bar">
        <div class="progress" id="progress-bar">
        </div>
      </div>
    </div>
    <form action="<%= basePath %>/submit_Wexner" method="post" class="surveyform">
      <input type="hidden" name="Mr_no" value="<%= Mr_no %>">
      <!-- <input type="hidden" id="selectedLang" name="selectedLang" value="en"> This line ensures that the current language is passed -->
      <input type="hidden" id="selectedLang" name="lang" value="<%= currentLang %>"> 
<!-- Question 1 -->
<div class="question-container active" id="question-1">
  <div class="back-button-first-question">
    <button type="button" onclick="previousQuestion()" style="display:none;"><i class='bx bx-chevrons-left'></i>Previous</button>
  </div>
  <p class="question-text" data-en="Q.1: I have incontinence of solid stool" data-ar="لدي سلس في البراز الصلب">Q.1: I have incontinence of solid stool:</p><br>

  <div id="form-wrapper">
    <div class="responsive-grid-radio">
        <div class="radio-grid">
            <input type="radio" name="I have incontinence of solid stool" id="solid_6" value="0" required>
            <label for="solid_6" data-en="Never" data-ar="أبدا">Never</label>
        </div>
        <div class="radio-grid">
            <input type="radio" name="I have incontinence of solid stool" id="solid_7" value="1" required>
            <label for="solid_7" data-en="Rarely" data-ar="نادرا">Rarely</label>
        </div>
        <div class="radio-grid">
            <input type="radio" name="I have incontinence of solid stool" id="solid_8" value="2" required>
            <label for="solid_8" data-en="Sometimes" data-ar="أحيانا">Sometimes</label>
        </div>
        <div class="radio-grid">
            <input type="radio" name="I have incontinence of solid stool" id="solid_9" value="3" required>
            <label for="solid_9" data-en="Usually" data-ar="عادة">Usually</label>
        </div>
        <div class="radio-grid">
            <input type="radio" name="I have incontinence of solid stool" id="solid_0" value="4" required>
            <label for="solid_0" data-en="Never" data-ar="دائما">Always</label>
        </div>
    </div>
  </div>


    
  <div id="form-wrapper-desktop">
      <div id="custom-radio">
            <input type="radio" name="I have incontinence of solid stool" id="solid_1" value="0" required>
            <label for="solid_1" data-en="Never" data-ar="أبدا">Never</label> 
            <input type="radio" name="I have incontinence of solid stool" id="solid_2" value="1" required>
            <label for="solid_2" data-en="Rarely" data-ar="نادرا">Rarely</label>
            <input type="radio" name="I have incontinence of solid stool" id="solid_3" value="2" required>
            <label for="solid_3" data-en="Sometimes" data-ar="أحيانا">Sometimes</label>
            <input type="radio" name="I have incontinence of solid stool" id="solid_4" value="3" required>
            <label for="solid_4" data-en="Usually" data-ar="عادة">Usually</label>
            <input type="radio" name="I have incontinence of solid stool" id="solid_5" value="4" required>
            <label for="solid_5" data-en="Never" data-ar="دائما">Always</label>
        <div id="custom-radio-pos"></div>
      </div>
    </div>
</div>
  

  
  

<!-- Question 2 -->
<div class="question-container" id="question-2">
      <div class="back-button">
        <button type="button" onclick="previousQuestion()"><i class='bx bx-chevrons-left'></i>Previous</button>
      </div>
  <p data-en="Q.2: I have liquid stool incontinence" data-ar="لدي سلس في البراز السائل">Q.2: I have liquid stool incontinence:</p><br>

  <div id="form-wrapper">
    <div class="responsive-grid-radio">
      <div class="radio-grid">
          <input type="radio" name="I have liquid stool incontinence" id="solid1_6" value="0" required>
          <label for="solid1_6" data-en="Never" data-ar="أبدا">Never</label>
      </div>
      <div class="radio-grid">
          <input type="radio" name="I have liquid stool incontinence" id="solid1_7" value="1" required>
          <label for="solid1_7" data-en="Rarely" data-ar="نادرا">Rarely</label>
      </div>
      <div class="radio-grid">
          <input type="radio" name="I have liquid stool incontinence" id="solid1_8" value="2" required>
          <label for="solid1_8" data-en="Sometimes" data-ar="أحيانا">Sometimes</label>
      </div>
      <div class="radio-grid">
          <input type="radio" name="I have liquid stool incontinence" id="solid1_9" value="3" required>
          <label for="solid1_9" data-en="Usually" data-ar="عادة">Usually</label>
      </div>
      <div class="radio-grid">
          <input type="radio" name="I have liquid stool incontinence" id="solid1_0" value="4" required>
          <label for="solid1_0" data-en="Never" data-ar="دائما">Always</label>
      </div>
    </div>
  </div>

  <div id="form-wrapper-desktop">
      <div id="custom-radio">
        <input type="radio" name="I have liquid stool incontinence" id="solid1_1" value="0" required>
            <label for="solid1_1" data-en="Never" data-ar="أبدا">Never</label> 
            <input type="radio" name="I have liquid stool incontinence" id="solid1_2" value="1" required>
            <label for="solid1_2" data-en="Rarely" data-ar="نادرا">Rarely</label>
            <input type="radio" name="I have liquid stool incontinence" id="solid1_3" value="2" required>
            <label for="solid1_3" data-en="Sometimes" data-ar="أحيانا">Sometimes</label>
            <input type="radio" name="I have liquid stool incontinence" id="solid1_4" value="3" required>
            <label for="solid1_4" data-en="Usually" data-ar="عادة">Usually</label>
            <input type="radio" name="I have liquid stool incontinence" id="solid1_5" value="4" required>
            <label for="solid1_5" data-en="Never" data-ar="دائما">Always</label>
        <div id="custom-radio-pos"></div>
      </div>
  </div>
</div>




<!-- Question 3 -->
<div class="question-container" id="question-3">
  <div class="back-button">
    <button type="button" onclick="previousQuestion()"><i class='bx bx-chevrons-left'></i>Previous</button>
  </div>
  <p data-en="Q.3: I have 'gas' type incontinence" data-ar="لدي سلس غازي">Q.3: I have 'gas' type incontinence:</p><br>

  <div id="form-wrapper">
    <div class="responsive-grid-radio">
      <div class="radio-grid">
          <input type="radio" name="I have 'gas' type incontinence" id="solid2_6" value="0" required>
          <label for="solid2_6" data-en="Never" data-ar="أبدا">Never</label>
      </div>
      <div class="radio-grid">
          <input type="radio" name="I have 'gas' type incontinence" id="solid2_7" value="1" required>
          <label for="solid2_7" data-en="Rarely" data-ar="نادرا">Rarely</label>
      </div>
      <div class="radio-grid">
          <input type="radio" name="I have 'gas' type incontinence" id="solid2_8" value="2" required>
          <label for="solid2_8" data-en="Sometimes" data-ar="أحيانا">Sometimes</label>
      </div>
      <div class="radio-grid">
          <input type="radio" name="I have 'gas' type incontinence" id="solid2_9" value="3" required>
          <label for="solid2_9" data-en="Usually" data-ar="عادة">Usually</label>
      </div>
      <div class="radio-grid">
          <input type="radio" name="I have 'gas' type incontinence" id="solid2_0" value="4" required>
          <label for="solid2_0" data-en="Never" data-ar="دائما">Always</label>
      </div>
    </div>
  </div>


    <div id="form-wrapper-desktop">
      <div id="custom-radio">
        <input type="radio" name="I have 'gas' type incontinence" id="solid2_1" value="0" required>
            <label for="solid2_1" data-en="Never" data-ar="أبدا">Never</label> 
            <input type="radio" name="I have 'gas' type incontinence" id="solid2_2" value="1" required>
            <label for="solid2_2" data-en="Rarely" data-ar="نادرا">Rarely</label>
            <input type="radio" name="I have 'gas' type incontinence" id="solid2_3" value="2" required>
            <label for="solid2_3" data-en="Sometimes" data-ar="أحيانا">Sometimes</label>
            <input type="radio" name="I have 'gas' type incontinence" id="solid2_4" value="3" required>
            <label for="solid2_4" data-en="Usually" data-ar="عادة">Usually</label>
            <input type="radio" name="I have 'gas' type incontinence" id="solid2_5" value="4" required>
            <label for="solid2_5" data-en="Never" data-ar="دائما">Always</label>
        <div id="custom-radio-pos"></div>
      </div>
    </div>
</div>




<!-- Question 4 -->
<div class="question-container" id="question-4">
  <div class="back-button">
    <button type="button" onclick="previousQuestion()"><i class='bx bx-chevrons-left'></i>Previous</button>
  </div>
  <p data-en="Q.4: I have to wear pads due to incontinence" data-ar="علي أن أرتدي وسادات بسبب السلس">Q.4: I have to wear pads due to incontinence:</p><br>

  <div id="form-wrapper">
    <div class="responsive-grid-radio">
      <div class="radio-grid">
          <input type="radio" name="I have to wear pads due to incontinence" id="solid3_6" value="0" required>
          <label for="solid3_6" data-en="Never" data-ar="أبدا">Never</label>
      </div>
      <div class="radio-grid">
          <input type="radio" name="I have to wear pads due to incontinence" id="solid3_7" value="1" required>
          <label for="solid3_7" data-en="Rarely" data-ar="نادرا">Rarely</label>
      </div>
      <div class="radio-grid">
          <input type="radio" name="I have to wear pads due to incontinence" id="solid3_8" value="2" required>
          <label for="solid3_8" data-en="Sometimes" data-ar="أحيانا">Sometimes</label>
      </div>
      <div class="radio-grid">
          <input type="radio" name="I have to wear pads due to incontinence" id="solid3_9" value="3" required>
          <label for="solid3_9" data-en="Usually" data-ar="عادة">Usually</label>
      </div>
      <div class="radio-grid">
          <input type="radio" name="I have to wear pads due to incontinence" id="solid3_0" value="4" required>
          <label for="solid3_0" data-en="Never" data-ar="دائما">Always</label>
      </div>
    </div>
  </div>

    <div id="form-wrapper-desktop">
      <div id="custom-radio">
        <input type="radio" name="I have to wear pads due to incontinence" id="solid3_1" value="0" required>
            <label for="solid3_1" data-en="Never" data-ar="أبدا">Never</label> 
            <input type="radio" name="I have to wear pads due to incontinence" id="solid3_2" value="1" required>
            <label for="solid3_2" data-en="Rarely" data-ar="نادرا">Rarely</label>
            <input type="radio" name="I have to wear pads due to incontinence" id="solid3_3" value="2" required>
            <label for="solid3_3" data-en="Sometimes" data-ar="أحيانا">Sometimes</label>
            <input type="radio" name="I have to wear pads due to incontinence" id="solid3_4" value="3" required>
            <label for="solid3_4" data-en="Usually" data-ar="عادة">Usually</label>
            <input type="radio" name="I have to wear pads due to incontinence" id="solid3_5" value="4" required>
            <label for="solid3_5" data-en="Never" data-ar="دائما">Always</label>
        <div id="custom-radio-pos"></div>
      </div>
    </div>
</div>




<!-- Question 5 -->
<div class="question-container" id="question-5">
  <div class="back-button">
    <button type="button" onclick="previousQuestion()"><i class='bx bx-chevrons-left'></i>Previous</button>
  </div>
  <p data-en="Q.5: Feel my lifestyle is altered due to incontinence to stool" data-ar="أشعر أن نمط حياتي تغير بسبب السلس إلى البراز">Q.5: Feel my lifestyle is altered due to incontinence to stool:</p><br>

  <div id="form-wrapper">
    <div class="responsive-grid-radio">
      <div class="radio-grid">
          <input type="radio" name="Feel my lifestyle is altered due to incontinence to stool" id="solid4_6" value="0" required>
          <label for="solid4_6" data-en="Never" data-ar="أبدا">Never</label>
      </div>
      <div class="radio-grid">
          <input type="radio" name="Feel my lifestyle is altered due to incontinence to stool" id="solid4_7" value="1" required>
          <label for="solid4_7" data-en="Rarely" data-ar="نادرا">Rarely</label>
      </div>
      <div class="radio-grid">
          <input type="radio" name="Feel my lifestyle is altered due to incontinence to stool" id="solid4_8" value="2" required>
          <label for="solid4_8" data-en="Sometimes" data-ar="أحيانا">Sometimes</label>
      </div>
      <div class="radio-grid">
          <input type="radio" name="Feel my lifestyle is altered due to incontinence to stool" id="solid4_9" value="3" required>
          <label for="solid4_9" data-en="Usually" data-ar="عادة">Usually</label>
      </div>
      <div class="radio-grid">
          <input type="radio" name="Feel my lifestyle is altered due to incontinence to stool" id="solid4_0" value="4" required>
          <label for="solid4_0" data-en="Never" data-ar="دائما">Always</label>
      </div>
      
    </div>
  </div>


    <div id="form-wrapper-desktop">
      <div id="custom-radio">
        <input type="radio" name="Feel my lifestyle is altered due to incontinence to stool" id="solid4_1" value="0" required>
            <label for="solid4_1" data-en="Never" data-ar="أبدا">Never</label> 
            <input type="radio" name="Feel my lifestyle is altered due to incontinence to stool" id="solid4_2" value="1" required>
            <label for="solid4_2" data-en="Rarely" data-ar="نادرا">Rarely</label>
            <input type="radio" name="Feel my lifestyle is altered due to incontinence to stool" id="solid4_3" value="2" required>
            <label for="solid4_3" data-en="Sometimes" data-ar="أحيانا">Sometimes</label>
            <input type="radio" name="Feel my lifestyle is altered due to incontinence to stool" id="solid4_4" value="3" required>
            <label for="solid4_4" data-en="Usually" data-ar="عادة">Usually</label>
            <input type="radio" name="Feel my lifestyle is altered due to incontinence to stool" id="solid4_5" value="4" required>
            <label for="solid4_5" data-en="Never" data-ar="دائما">Always</label>
        <div id="custom-radio-pos"></div>
      </div>
      
    </div>

    

</div>


<div class="nav-buttons">
  <button type="submit">
    <i class='bx bx-check-double'></i> Submit
  </button>
</div>



</form>




<script>
  let currentLang = 'en'; // Default language
  let currentQuestion = 0;

  const questions = document.querySelectorAll('.question-container');
  const progressBar = document.getElementById('progress-bar');
  const selectedLangInput = document.getElementById('selectedLang'); // Hidden input for language

  function updateProgressBar() {
    const progress = ((currentQuestion + 1) / questions.length) * 100;
    progressBar.style.width = `${progress}%`;
  }

  function showQuestion(index) {
    questions.forEach((question, i) => {
      question.classList.toggle('active', i === index);
    });
    updateProgressBar();
    
    // Check if we're at the last question
    const submitButton = document.querySelector('.nav-buttons button[type="submit"]');
    if (currentQuestion === questions.length - 1) {
      submitButton.style.display = 'block'; // Show submit button
    } else {
      submitButton.style.display = 'none'; // Hide submit button
    }
  }

  // document.querySelectorAll('.radio-grid').forEach(function (grid) {
  //   grid.addEventListener('click', function () {
  //     const label = this.querySelector('label');
  //     if (label) {
  //       label.click();  // Simulate a click on the label
  //     }
  //   });
  // });

  const charLimit = 80;

  function toggleText() {
    var dots = document.getElementById("dots");
    var moreText = document.getElementById("more-text");
    var toggleBtn = document.getElementById("toggle-btn");

    if (moreText.style.display === "none") {
      dots.style.display = "none"; // Hide the dots
      moreText.style.display = "inline"; // Show the extra text
      toggleBtn.innerHTML = " Show Less"; // Change text to "Show Less"
    } else {
      dots.style.display = "inline"; // Show the dots
      moreText.style.display = "none"; // Hide the extra text
      toggleBtn.innerHTML = " Show More"; // Change text back to "Show More"
    }
  }

  // Function to handle truncation based on screen size (mobile vs desktop)
  function setInitialText() {
    var fullText = "This Wexner PROMS is designed to help us understand your bowel habits and your symptoms and overall quality of life. By completing this survey, you provide valuable information that enables us to offer you the best possible care and support tailored to your needs."; 
    var truncatedText = fullText.substring(0, charLimit);

    if (window.innerWidth < 768) {
      if (fullText.length > charLimit) {
        document.getElementById("text").innerHTML = 
          truncatedText + 
          '<span id="dots">...</span>' +
          '<span id="more-text" style="display:none;">' + 
          fullText.substring(charLimit) + 
          '</span>' + 
          '<span id="toggle-btn" style="color: blue; cursor: pointer;" onclick="toggleText()"> Show More</span>';
      } else {
        document.getElementById("text").innerHTML = fullText;
      }
    } else {
      document.getElementById("text").innerHTML = fullText;
    }
  }

  window.onload = setInitialText;
  window.onresize = setInitialText;

  function nextQuestion() {
    const currentInputs = questions[currentQuestion].querySelectorAll('input[type="radio"]');
    let answered = false;

    currentInputs.forEach(input => {
      if (input.checked) {
        answered = true;
      }
    });

    if (answered) {
      if (currentQuestion < questions.length - 1) {
        setTimeout(() => {
          currentQuestion++;
          showQuestion(currentQuestion);
        }, 500);
      }
    }
  }

  function previousQuestion() {
    if (currentQuestion > 0) {
      currentQuestion--;
      showQuestion(currentQuestion);
  
      // Reattach the event listeners after showing the previous question
      addRadioEventListeners();
    }
  }
  
  function addRadioEventListeners() {
    questions.forEach((question, questionIndex) => {
      const radioInputs = question.querySelectorAll('input[type="radio"]');
  
      radioInputs.forEach(input => {
        // Remove any existing event listener before adding a new one to avoid multiple triggers
        input.removeEventListener('click', handleRadioClick);
        input.addEventListener('click', handleRadioClick);
      });
    });
  }
  
  function handleRadioClick() {
    if (currentQuestion === questions.length - 1) {
      return; // Do nothing if we are on the last question
    }
    nextQuestion();
  }
  
  

  // Function to toggle the language
  function toggleLanguage() {
    currentLang = currentLang === 'en' ? 'ar' : 'en';
    
    // Update the hidden language input field
    selectedLangInput.value = currentLang;
    
    // Loop through all question containers
    questions.forEach(question => {
      const enContent = question.querySelector('.en-content');
      const arContent = question.querySelector('.ar-content');
      
      if (enContent && arContent) {
        enContent.style.display = currentLang === 'en' ? 'block' : 'none';
        arContent.style.display = currentLang === 'en' ? 'none' : 'block';
      }
    });

    // Update the text for headings and other elements with data-en/data-ar attributes
    document.querySelectorAll('[data-en]').forEach(el => {
      el.innerText = el.getAttribute(`data-${currentLang}`);
    });
    
    // Update the language toggle button text
    document.querySelector('.lang-toggle').innerText = currentLang === 'en' ? 'العربية' : 'English';

    // Update the URL to reflect the current language without refreshing the page
    const url = new URL(window.location.href);
    url.searchParams.set('lang', currentLang);
    window.history.pushState({}, '', url);
  }

  // Initialize to ensure correct language and show first question
  document.addEventListener('DOMContentLoaded', function() {
    // Get the current URL
    const url = new URL(window.location.href);

    // Check if the URL contains a 'lang' parameter, if not, set it to 'en'
    let langParam = url.searchParams.get('lang');
    if (!langParam || langParam === 'undefined') {
        langParam = 'en';  // Default to 'en' if no 'lang' parameter is present
        url.searchParams.set('lang', 'en'); // Update the URL to include 'lang=en'
        window.history.replaceState({}, '', url); // Replace the URL without refreshing the page
    }

    // Update the hidden language input field and currentLang variable
    currentLang = langParam;
    document.getElementById('selectedLang').value = currentLang;

    // Ensure the correct language content is displayed on load
    questions.forEach(question => {
        const enContent = question.querySelector('.en-content');
        const arContent = question.querySelector('.ar-content');
        
        if (enContent && arContent) {
            enContent.style.display = currentLang === 'en' ? 'block' : 'none';
            arContent.style.display = currentLang === 'en' ? 'none' : 'block';
        }
    });

    // Set the toggle button text based on the current language
    document.querySelector('.lang-toggle').innerText = currentLang === 'en' ? 'العربية' : 'English';

    // Initially show the first question and add event listeners
    showQuestion(0);
    addRadioEventListeners();
  });
</script>



</body>
</html>

